<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

    <title>Logo Nav - Start Bootstrap Template</title>

    <!-- Bootstrap core CSS -->

    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.3/css/bootstrap.min.css"
          integrity="sha384-Zug+QiDoJOrZ5t4lssLdxGhVrurbmBWopoEl+M6BdEfwnCJZtKxi1KgxUyJq13dy" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
            integrity="sha256-3edrmyuQ0w65f8gfBsqowzjJe2iM6n0nKciPUp8y+7E="
            crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.3/js/bootstrap.min.js"
            integrity="sha384-a5N7Y/aK3qNeh15eJKGWxsqtnX/wWdSZSKp+81YjTmS15nvnvxKHuzaWwXHDli+4"
            crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/gh/atatanasov/gijgo@1.7.3/dist/combined/js/gijgo.min.js"
            type="text/javascript"></script>
    <link href="https://cdn.jsdelivr.net/gh/atatanasov/gijgo@1.7.3/dist/combined/css/gijgo.min.css" rel="stylesheet"
          type="text/css"/>
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.18/css/jquery.dataTables.min.css"/>
    <script type="text/javascript" src="https://cdn.datatables.net/1.10.18/js/jquery.dataTables.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.11.2/moment.min.js"></script>
    <script src="//cdn.datatables.net/plug-ins/1.10.12/sorting/datetime-moment.js"></script>
    <script defer src="https://use.fontawesome.com/releases/v5.0.9/js/all.js"
            integrity="sha384-8iPTk2s/jMVj81dnzb/iFR2sdA7u06vHJyyLlAd4snFpCl/SnyUjRrbdJsw1pGIl"
            crossorigin="anonymous"></script>
    <!--Precisa para usar o botão switch-->
    <link href="https://gitcdn.github.io/bootstrap-toggle/2.2.2/css/bootstrap-toggle.min.css" rel="stylesheet">
    <script src="https://gitcdn.github.io/bootstrap-toggle/2.2.2/js/bootstrap-toggle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery-validation@1.17.0/dist/jquery.validate.min.js"></script>
    <style>
        .navbar.sheetgo_green {
            box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 3px 1px -2px rgba(0, 0, 0, 0.2), 0 1px 5px 0 rgba(0, 0, 0, 0.12);
        }

        .centralizar {
            margin: 0 auto;
        }

        .esconder {
            display: none;
        }

        .branco {
            color: white;
        }

        .delete-click {
            cursor: pointer;
        }

        .delete-click:hover {
            text-decoration: underline;
        }

        .button-design:focus {
            outline: none;
        }

        .button-material {
            border-radius: 2px;
            -webkit-box-shadow: 0px 3px 1px -2px rgba(0, 0, 0, 0.2), 0px 2px 2px 0px rgba(0, 0, 0, 0.14), 0px 1px 5px 0px rgba(0, 0, 0, 0.12);
            padding: 0;
            cursor: pointer;
            text-align: left;
        }

        .padding-button {
            padding: 1em;
        }

        .col-md-5-5 {
            width: 45.83%
        }

        .col-md-cards {
            width: 30.55%;
        }

        .col-md-04 {
            width: 4.16%
        }

        .img-border {
            border-top-right-radius: 2px;
            border-top-left-radius: 2px;
        }

        .card:hover {
            box-shadow: 0 12px 16px 0 rgba(0, 0, 0, 0.24), 0 17px 50px 0 rgba(0, 0, 0, 0.19);
        }

        /* Bootstrap Toggle v2.2.2 corrections for Bootsrtap 4*/
        .toggle-off {
            box-shadow: inset 0 3px 5px rgba(0, 0, 0, .125);
        }

        .toggle.off {
            border-color: rgba(0, 0, 0, .25);
        }

        .toggle-handle {
            background-color: white;
            border: thin rgba(0, 0, 0, .25) solid;
        }

        .toggle.ios, .toggle-on.ios, .toggle-off.ios {
            border-radius: 20px;
        }

        .toggle.ios .toggle-handle {
            border-radius: 20px;
        }

        td.details-control {
            background: url('http://next.datatables.net/examples/resources/details_open.png') no-repeat center center;
            cursor: pointer;
        }

        tr.shown td.details-control {
            background: url('http://next.datatables.net/examples/resources/details_close.png') no-repeat center center;
        }
    </style>
</head>

<body style="font-family: Roboto, Arial;background-color: rgba(0, 0, 0, 0.05);">
<!-- Navigation -->
<nav class="navbar navbar-expand-lg navbar-dark sheetgo_green fixed-top" style="background-color: #388e3c;">

    <div class="container" style="display: -webkit-box;">
        <a class="navbar-brand col-md-2" href="#">
            <img src="https://static.sheetgo.com/wp-content/uploads/2017/12/SheetGo_site_white.png"
                 alt="Sheetgo logo" onclick="homePage()" style="width: 4em">
        </a>

        <div class="home-title  branco" style="margin-left: 30px;">Admin Panel</div>


        <div class="transfer-title esconder branco" style="margin-left: 30px;">Transfer Connections</div>

        <!-- BUSCA DE REGISTROS-->
        <div class="register-title esconder branco">User Profile</div>
        <div class="registro form-inline col-md-5" style=" display:none;">
            <div class="form-group col-md-9" style="padding-left: 0">
                <input type="email" class="form-control col-md-12 " id="email-registro"
                       placeholder="Email Address - email@example.com">
            </div>
            <button type="button" class="btn btn-dark sheetgo_green col-md-3" id="botao-registro">Search
            </button>
        </div>

        <!-- BUSCA DATATABLE -->
        <div class="table-title esconder branco">Check Users</div>
        <div class="table-home form-inline col-md-5" style=" display:none;">
            <div class="form-group col-md-9" style="padding-left: 0">
                <input type="email" class="form-control col-md-12 centralizar " id="email-table"
                       placeholder=" Email Address - email@example.com">
            </div>
            <button type="button" class="btn btn-dark sheetgo_green col-md-3" id="botao-table">Search
            </button>
        </div>


        <div class="collapse navbar-collapse col-md-4" id="navbarResponsive">
            <ul class="navbar-nav ml-auto">
                <li class="nav-item">
                    <a class="nav-link" href="#" onclick="paginaTransfer()">Transfer Connections
                        <span class="sr-only">(current)</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#" onclick="paginaCadastro()">User Profile</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#" onclick="paginaTable()">Check Users</a>
                </li>
            </ul>
        </div>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive"
                aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
    </div>
</nav>
<!-- Page Content -->
<div class="container centralizar body-page" style="padding: 40px;width: 80%;">
    <table id="usersInfo" class="table table-striped table-bordered nowrap" cellspacing="0" width="100%"></table>
    <table id="connectionsInfo" class="table table-striped table-bordered nowrap" cellspacing="0" width="100%"></table>
    <div class="row home-buttons" style="padding-top: 60px;text-align: center">
        <div class="col-md-12 centralizar" style="display:flex;flex-wrap:wrap ">
            <a class="col-md-cards transfer-icon button-material card" style="background-color: white"
               onclick="paginaTransfer()">
                <div style="width: 100%;">
                    <img class="img-border" src="https://sheetgo.com/static/admin/transfer.png"
                         width="100%">

                </div>
                <div class="padding-button">
                    <h5 class="">Transfer Connections</h5>
                </div>

            </a>
            <div class="col-md-04">
            </div>

            <a class="col-md-cards edit-icon button-material card" style="background-color: white"
               onclick="paginaCadastro()">
                <div style="width: 100%;">
                    <img class="img-border" src="https://sheetgo.com/static/admin/edituser.png"
                         width="100%">

                </div>
                <div class="padding-button">
                    <h5>User Profile</h5>
                </div>
            </a>
            <div class="col-md-04">
            </div>
            <a class="col-md-cards transfer-icon button-material card" style="background-color: white"
               onclick="paginaTable()">
                <div style="width: 100%;">
                    <img class="img-border" src="https://sheetgo.com/static/admin/table.png"
                         width="100%">

                </div>
                <div class="padding-button">
                    <h5 class="">Check Users</h5>
                </div>
            </a>
        </div>
    </div>
    <!--FORMULARIO DE TRANSFERENCIA-->

    <form class="formulario col-md-7 centralizar esconder" style="padding-top: 30px;">
        <div class="form-group">
            <label>From Email address</label>
            <input type="email" class="form-control col-md-12" id="from" aria-describedby="emailHelp"
                   placeholder="Enter email" required>
            <small id="emailHelp" class="form-text text-muted">This email will transfer all connections.</small>
        </div>
        <div class="form-group">
            <label>To Email address</label>
            <input type="emailHelp" class="form-control col-md-12" id="to" placeholder="Enter email" required>
            <small id="emailHelp2" class="form-text text-muted">Email to get all connections!</small>

        </div>
        <button type="button" class="btn btn-dark sheetgo_green margin_bot" id="botao-transferencia"
                style=" margin-bottom: 15px;"
                onclick="transfer()">Transfer
        </button>
    </form>

    <!--FORMULÁRIO PARA ALTERAR OS DADOS-->

    <form class="mudar col-md-9 centralizar" id="form-registers" style=" display: none; padding-top: 30px">
        <h1 style="margin:50px 0;text-align: center;display: none">Users</h1>
        <div class="form-row">
            <div class="form-group col-md-12">
                <h4 id="registro-user" style="text-align: center">email@example.com</h4>
            </div>
        </div>
        <div class="form-row" hidden>
            <div class="form-group col-md-12">
                <h6 id="email-user" style="text-align: center">email@example.com</h6>
            </div>
        </div>


        <div class="form-row">
            <div class="form-group  col-md-4" style="text-align: center">
                <label id="subscription">Subscription: </label>
            </div>
            <div class="form-group  col-md-4" style="text-align: center">
                <button type="button" class="btn btn-link sheetgo_green margin_bot col-md-12"
                        style=" margin-bottom: 15px; padding: 0"
                        id="connections"
                        onclick="dataTableConnections()"><i class="fas fa-table"></i> Connections
                </button>
            </div>
            <div class="form-group  col-md-4" style="text-align: center">
                <button type="button" class="btn btn-link sheetgo_green margin_bot col-md-12"
                        style=" margin-bottom: 15px; padding: 0"
                        id="log-changes"
                        onclick="logChanges()"><i class="far fa-address-card"></i> Log changes
                </button>
            </div>
        </div>
        <div class="form-row">

            <div class="form-group  col-md-6" style="text-align: center">
                <label id="beta-tester" style="margin-right:4px">Beta Tester: </label>
                <input id="beta-toggle" type="checkbox" checked data-toggle="toggle" data-size="small" data-on="Yes"
                       data-off="No" data-onstyle="success" data-offstyle="danger">
                <p id="beta-event" style="display: none"></p>
            </div>
            <div class="form-group  col-md-6" style="text-align: center">
                <label id="iframe-tester" style="margin-right:4px">iFrame: </label>
                <input id="iframe-toggle" type="checkbox" checked data-toggle="toggle" data-size="small" data-on="Yes"
                       data-off="No" data-onstyle="success" data-offstyle="danger">
                <p id="iframe-event" style="display: none"></p>
            </div>
        </div>
        <div class="form-row">
            <div class="form-group  col-md-6">
                <label for="inputName" id="registro-name">Name:</label>
                <input type="text" class="form-control" id="inputName">
            </div>
            <div class="form-group col-md-6">
                <label for="inputLastName" id="registro-lastname">Lastname:</label>
                <input type="text" class="form-control" id="inputLastName">
            </div>
        </div>
        <div class="form-row">
            <div class="form-group col-md-4">
                <label for="inputPlan" id="registro-plantype">Plan Type: </label>
                <select id="inputPlan" class="form-control">
                    <option value="99">Free</option>
                    <!--<option value="2">Starter</option>-->
                    <option value="1">Advanced</option>
                    <option value="10">Professional</option>
                    <option value="100">Enterprise</option>
                </select>
            </div>
            <div class="form-group  col-md-4">
                <label for="inputPeriod" id="registro-period">User Recurrency:</label>
                <select class="form-control" id="inputPeriod">
                    <option value="">No Recurrency</option>
                    <option value="1 M">1 Month</option>
                    <option value="3 M">3 Months</option>
                    <option value="1 Y">1 Year</option>
                </select>
            </div>

            <div class="form-group  col-md-4">
                <label for="datepicker" id="registro-expire">Expire On <i class="far fa-clock" style="color:green"
                                                                          onclick="today()"></i> :</label>
                <input id="datepicker" class="inputExpire"/>
            </div>


        </div>
        <div class="form-row">
            <div class="form-group  col-md-4">
                <label for="inputAccess" id="registro-access">Last Access:</label>
                <input type="text" class="form-control" id="inputAccess" disabled="true">
            </div>
            <div class="form-group  col-md-4">
                <label for="inputCreated" id="registro-created">Created At:</label>
                <input type="text" class="form-control" id="inputCreated" disabled="true">
            </div>

            <div class="form-group col-md-4" style="display: none">
                <label for="inputBonus" id="registro-bonus">Bonus remaining:</label>
                <input type="number" class="form-control" id="inputBonus" min="0" step="100">
            </div>
        </div>
        <div class="form-row" style="display: none">
            <div class="form-group  col-md-4">
                <label for="inputQuotas" id="registro-quotas">Quotas:</label>
                <input type="text" class="form-control" id="inputQuotas" disabled="true">
            </div>
            <div class="form-group col-md-4">
                <label for="inputLastMonth" id="registro-lastMonth">Last Month Updates:</label>
                <input type="text" class="form-control" id="inputLastMonth" disabled="true">
            </div>
            <div class="form-group col-md-4">
                <label for="inputMonthly" id="registro-monthly">Monthly Updates:</label>
                <input type="text" class="form-control" id="inputMonthly" disabled="true">
            </div>
        </div>
        <div class="form-row">
            <div class="form-group  col-md-6">
                <label for="inputSubId" id="registro-subId">Subscription Id:</label>
                <input type="text" class="form-control" id="inputSubId">
            </div>
            <div class="form-group col-md-6">
                <label for="inputTeams" id="registro-teams">For Teams:</label>
                <select class="form-control" id="inputTeams">
                    <option value="true">Yes</option>
                    <option value="false">No</option>
                </select>
            </div>
        </div>
        <div class="form-row">
            <div class="form-group col-md-12">
                <label for="observation">Observations:</label>
                <textarea class="form-control" id="observation"></textarea>
                <span class="small text-muted"> You can save some notes here.</span>
            </div>
        </div>
        <div class="form-row">
            <div class="form-group col-md-12">
                <label for="justification">Justification: <span
                        style="color: red">*</span></label>
                <select class="form-control" id="justification" required>
                    <option disabled selected value="0"> -- Please, select an option! --</option>
                    <option value="Bonus">Bonus</option>
                    <option value="Change Ownership">Change Ownership</option>
                    <option value="Correction Last Input">Correction Last Input</option>
                    <option value="Downgrade">Downgrade</option>
                    <option value="Upgrade">Upgrade</option>
                    <option value="Sales">Sales</option>
                    <option value="Others">Others</option>
                    <option value="Testing">Testing</option>
                </select>
                <span class="small text-muted"> Please provide a justification for changes.</span>
            </div>
        </div>
        <div class="col-md-4" style="margin: 15px auto">
            <button type="button" class="btn btn-dark sheetgo_green margin_bot col-md-12"
                    style=" margin-bottom: 15px;"
                    id="save-button"
                    onclick="saveRegister()" title="Justification is a required field *" data-toggle="popover"
                    data-trigger="focus" data-content="Please, justify your changes!!!">Save
            </button>
        </div>
        <span class="small delete-click text-muted" onclick="delete_modal()"> Delete all user's data permantly!</span>
    </form>

    <!-- Delete Modal -->
    <div class="modal fade" id="deleteModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle"
         aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLongTitle">Are you sure?</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    This action will delete all user's data saved on our database, Intercom, Stripe, BigQuery and from
                    all spreadsheets!
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" onclick="confirm_delete_modal()">Delete</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Confirm Modal -->
    <div class="modal fade" id="confirmModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle"
         aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLongTitle2">This action can not be reverted!</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <span>Please input the user email</span>
                    <input type="text" class="form-control" id="input-delete-user" placeholder="Username"
                           aria-label="Username"
                           aria-describedby="basic-addon1" required>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="btn-confirm-delete" disabled="disabled"
                            onclick="delete_user_data()">Confirm
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Success Modal -->
    <div class="modal fade" id="successModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle"
         aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLongTitle3">SUCCESS</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <span>This user has been deleted!</span>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Success Modal -->
    <div class="modal fade" id="failModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle"
         aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLongTitle4">ERROR</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <span>The process failed, try again later!</span>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

</div>
<script>
    //var dataSet = dataTableUsers();
    $(document).ready(function () {

        $("#email-table").keypress(function (k) {
            var key = k.which;
            if (key == 13) { // the enter key code
                $('.mudar').hide();
                dataTableUsers();
                $(".list-group").remove()
            }
        });
        $("#botao-table").click(function () {
            console.log("pronto");
            $('.mudar').hide();
            dataTableUsers();
            // $(".table").remove()
            // $('.form-control').val('')
        });

        var email = '<?!=email?>';
        console.log(email);
        if (email) {
            paginaCadastro();
            $('#emailRegistro').val(email);
            mudarDados(email)
        }

        $('[data-toggle="popover"]').popover();
        $("#email-registro").keypress(function (k) {
            var key = k.which;
            if (key == 13) { // the enter key code
                mudarDados();
                $(".list-group").remove()
            }
        });

        $("#botao-registro").click(function () {
            console.log("pronto");
            mudarDados();
            $(".list-group").remove()
            // $('.form-control').val('')
        });
        $.fn.dataTable.moment('MM/DD/YYYY');

        $("#input-delete-user").on("keyup blur", function () {
            $("#btn-confirm-delete").prop("disabled", false);
            if ($("#input-delete-user").val() !== $('#registro-user').text()) {
                $("#btn-confirm-delete").prop("disabled", true);
            }
        });


    });
    $(function () {
        $('#beta-toggle').change(function () {
            $('#beta-event').text($(this).prop('checked'))
        });
        $('#iframe-toggle').change(function () {
            $('#iframe-event').text($(this).prop('checked'))
        })
    });

    function delete_modal() {
        $('#deleteModal').modal('show')
    }

    function confirm_delete_modal() {
        $('#confirmModal').modal('show');
        $('#deleteModal').modal('hide');
    }

    function success_delete_modal() {
        $('#successModal').modal('show');
        $('#confirmModal').modal('hide');
        $('#deleteModal').modal('hide');
    }
    function fail_delete_modal() {
        $('#failModal').modal('show');
        $('#successModal').modal('hide');
        $('#confirmModal').modal('hide');
        $('#deleteModal').modal('hide');
    }

    //função para destravar o botão e retornar seu comportamento padrão
    function destravar_botao_transferencia() {
        $('#botao-transferencia').html('Transfer').removeAttr('disabled');
//        $('#botao').removeAttr('disabled');
    }

    function destravar_botao_registro() {
        $('#botao-registro').html('Search').removeAttr('disabled');
//        $('#botao').removeAttr('disabled');
    }

    function destravar_botao_table() {
        $('#botao-table').html('Search').removeAttr('disabled');
//        $('#botao').removeAttr('disabled');
    }

    function today() {
        var today = new Date();
        var formatedToday = ('0' + (today.getMonth() + 1)).slice(-2) + '/' + ('0' + today.getDate()).slice(-2) + '/' + today.getFullYear();
        $('.inputExpire').val(formatedToday);

    }

    function logChanges() {
        var user = $('#registro-user').text();
        window.open('https://docs.google.com/spreadsheets/d/1hGmf-q1j7HB7bbbG735ntbMoSzn-z7J8pcT9VsWy2JM/gviz/tq?tqx=out:html&tq=SELECT%20*%20WHERE%20B%20%3D%20%22' + user + '%22&headers=1&sheet=Users', '_blank');
    }

    function transfer() {
        var from = $("#from").val();
        var to = $("#to").val();
        $(".alert").remove();
        $('#botao-transferencia').html('Wait...').attr('disabled', 'disabled');

        google.script.run.withSuccessHandler(function (e) {
            //Função recebe um {JSON} e faz uma comparação.
            console.log(e);
            //Caso o usuário for inválido, inexistente ou exceder o limite de conexões, irá retornar um alerta de erro.
            if (e.status === 0) {
                destravar_botao_transferencia();
                $('.formulario').append('<div class="alert alert-danger alert-dismissable"><a href="#" class="close" data-dismiss="alert" aria-label="close">×</a></div>');
                $(".alert-danger").append(e.message)
                //Se as informações forem válidas, uma alerta será exibido com a mensagem de Sucesso.
            } else {
                destravar_botao_transferencia();
                $('.formulario').append('<div class="alert alert-success alert-dismissable"><a href="#" class="close" data-dismiss="alert" aria-label="close">×</a>The Transfer has been completed :)</div>');
                $('.form-control').val('')

            }

        }).withFailureHandler(function (e) {
            // Caso aconteça algum erro no Back_End, irá cair nessa função e retornar um erro especifíco.
            destravar_botao_transferencia();
            $('.formulario').append('<div class="alert alert-danger alert-dismissable"><a href="#" class="close" data-dismiss="alert" aria-label="close">×</a></div>');
            $(".alert-danger").append('ERROR ' + e.message);
            console.log(e)


        }).transfer_connections_1(from, to);
        return false;
    }

    /**Função para salvar os novos dados do usuário
     * Ela não recebe nada, mas acessa os valores dos inputs por JQuery
     * @returns {object} para o back-end
     */
    function saveRegister() {
        // console.log('salvo com sucesso');
        usuario = {};
        usuario.username = $('#registro-user').text();
        usuario.firstName = $('#inputName').val();
        usuario.lastName = $('#inputLastName').val();
        var data = $("#datepicker").val().split("/");
        //var formatedData = new Date(data[2], data[0] ,data[1] - 1, '19', '59', '59');
        var formatedData = new Date(data[2] + "-" + data[0] + "-" + data[1] + "T20:59:00Z");
        usuario.expireOn = formatedData.toISOString();

        //usuario.quota = $('#inputQuotas').val();
        usuario.bonus = parseInt($('#inputBonus').val());
        usuario.planType = parseInt($('#inputPlan').val());
        usuario.justification = $('#justification').val();
        usuario.subscr_id = $('#inputSubId').val();
        usuario.planPeriod = $('#inputPeriod').val();
        usuario.Notes = $('#observation').val();
        usuario.email = $('#email-user').text();
        usuario.beta_tester = JSON.parse($('#beta-event').text());
        usuario.iframe = JSON.parse($('#iframe-event').text());
        usuario.teams = $('#inputTeams').val() == "true" ? true : false;
        if (usuario.justification === '' || usuario.justification.length < 5) {
            console.log('Falta a Justificativa');
            return ''
        }
        console.log(usuario);
        $('#save-button').html('Saving...').attr('disabled', 'disabled');

        google.script.run.withSuccessHandler(retornoSaveUser).withFailureHandler(retornoSaveUserErro).saveUserData(usuario);

    }

    // Caso de certo a transferência, vai exibir um alerta com a mensagem de Sucesso
    function retornoSaveUser(e) {
        if (e.status === 0) {
            $('.body-page').append('<div class="alert alert-danger alert-dismissable" style="margin-top: 50px;"><a href="#" class="close" data-dismiss="alert" aria-label="close">×</a></div>');
            $(".alert-danger").append('ERROR ' + e.message)
        } else {
            console.log('Success');
            mudarDados(usuario.username);
            $('.body-page').append('<div class="alert alert-success alert-dismissable col-md-12" style="margin-top: 50px;"><a href="#" class="close" data-dismiss="alert" aria-label="close">×</a>The changes has been completed :)</div>');
            $('.form-control').val('')
        }
        $('#save-button').html('Save').removeAttr('disabled');

    }

    // Retorna um alerta de Erro caso de alguma falha
    function retornoSaveUserErro(e) {
        $('#save-button').html('Save').removeAttr('disabled');
        $('.body-page').append('<div class="alert alert-danger alert-dismissable" style="margin-top: 50px;"><a href="#" class="close" data-dismiss="alert" aria-label="close">×</a>ERROR. No changes was made. </div>');
        console.log('Erro no Back-End');


    }

    //Função para acessar a Home.
    function homePage() {
        $('.alert').remove();
        $('.home-buttons').show();
        $('.registro').hide();
        $('.mudar').hide();
        $('.register-title').hide();
        $('.formulario').hide();
        $('.transfer-title').hide();
        $('.table-title').hide();
        $('.dt-bootstrap4').hide();
        $("#connectionsInfo").remove();
        $("#connectionsInfo_wrapper").remove();
        $("#usersInfo").hide();
        $("#usersInfo_wrapper").hide();
        $('.table-home').hide();
        $('.home-title').show()
    }


    // Ao clicar nos itens do nav-bar muda a página.
    function paginaTransfer() {
        $('.home-buttons').hide();
        $('.registro').hide();
        $('.mudar').hide();
        $('.alert').remove();
        $('.register-title').hide();
        $('.home-title').hide();
        $('.table-title').hide();
        $('.table-home').hide();
        $('.dt-bootstrap4').hide();
        $("#connectionsInfo").remove();
        $("#connectionsInfo_wrapper").remove();
        $("#usersInfo").hide();
        $("#usersInfo_wrapper").hide();
        $('.transfer-title').show();
        $('.formulario').show();

    }

    // Ao clicar nos itens do nav-bar muda a página.
    function paginaCadastro() {
        $('.alert').remove();
        $('.home-buttons').hide();
        $('.formulario').hide();
        $('.table-title').hide();
        $('.table-home').hide();
        $('.transfer-title').hide();
        $('.home-title').hide();
        $('.dt-bootstrap4').hide();
        $("#connectionsInfo").remove();
        $("#connectionsInfo_wrapper").remove();
        $("#usersInfo").hide();
        $("#usersInfo_wrapper").hide();
        $('.register-title').show();
        $('.registro').show();


    }

    //Função para mostrar a página de DataTable e ocultar outras páginas.
    function paginaTable() {
        $('.home-buttons').hide();
        $('.formulario').hide();
        $('.mudar').hide();
        $('.alert').remove();
        $('.transfer-title').hide();
        $('.home-title').hide();
        $('.register-title').hide();
        $('.registro').hide();
        $("#connectionsInfo").remove();
        $("#connectionsInfo_wrapper").remove();
        $("#usersInfo").show();
        $("#usersInfo_wrapper").show();
        $('.dt-bootstrap4').show();
        $('.table-title').show();
        $('.table-home').show();


    }

    /**
     *
     */
    function delete_user_data() {

        $('#btn-confirm-delete').html('Wait...').attr('disabled', 'disabled');

        var current_user = $('#registro-user').text();

        var email_to_delete = $('#input-delete-user').val();


        if (current_user === email_to_delete) {

            google.script.run.withSuccessHandler(function (resultado) {
                if (resultado.status !== 0) {

                    console.log('Success');

                    success_delete_modal();

                    homePage();

                } else {

                    fail_delete_modal();

                    console.log('The process failed, try again');
                }

            }).withFailureHandler(function (resultado) {

                $('.body-page').append('<div class="alert alert-danger alert-dismissable" style="margin-top: 50px;"><a href="#" class="close" data-dismiss="alert" aria-label="close">×</a></div>');
                $(".alert-danger").html('ERROR ' + resultado.message);
                console.log(resultado)

            }).deleteUser(email_to_delete);

        }
    }

    /**Esconde a página de busca, trás a página com os dados do usuário caso não de erro.
     * Recebe os dados do usuário consultados no banco de dados e mostra nos Inputs
     * @returns Não retorna nada, só pega os dados do usuário .
     */
    function mudarDados(email) {

        $(".list-group").remove();
        $("#connectionsInfo").remove();
        $("#connectionsInfo_wrapper").remove();
        $('.formulario').hide();
        var user = email || $('#email-registro').val();
        $('#justification').val(0);
        $(".alert").remove();
        $('#botao-registro').html('Wait...').attr('disabled', 'disabled');

        google.script.run.withSuccessHandler(function (resultado) {
            //Caso o usuário for inválido, inexistente ou exceder o limite de conexões, irá retornar um alerta de erro.
            if (resultado.status !== 0) {
                $('.situation').remove();
                $('#registro-user').text(resultado.username);
                $('#inputName').val(resultado.firstName);
                $('#justification').val("0");
                $('#inputLastName').val(resultado.lastName);
                var datepicker = $('#datepicker').datepicker({
                    uiLibrary: 'bootstrap4',
                    format: 'mm/dd/yyyy'

                }).value(resultado.expireOn);
                $('#email-user').text(resultado.email);
                $('#inputAccess').val(resultado.lastAccess);
                $('#inputPlan').val(resultado.planType);
                $('#inputQuotas').val(resultado.quota);
                $('#inputBonus').val(resultado.bonus);
                $('#inputPeriod').val(resultado.planPeriod);
                $('#inputSubId').val(resultado.subscr_id);
                $('#inputTeams').val((resultado.teams).toString());
                $('#inputLastMonth').val(resultado.lastMonthUpdates);
                $('#inputMonthly').val(resultado.monthlyUpdates);
                $('#inputCreated').val(resultado.createdAt);
                $('#observation').val(resultado.Notes);

                if (resultado.beta_tester != true) {
                    $('#beta-toggle').bootstrapToggle('off')

                } else {
                    $('#beta-toggle').bootstrapToggle('on')

                }
                if (resultado.iframe != true) {
                    $('#iframe-toggle').bootstrapToggle('off')

                } else {
                    $('#iframe-toggle').bootstrapToggle('on')

                }

                //Desvio condicional para mostrar Free, Active ou Expired
                if (resultado.planType != 99) {
                    if (resultado.active == true) {
                        $('#subscription').append('<span class="situation font-weight-bold" style="color: #22d822">Active</span>');
                    }
                    else {
                        $('#subscription').append('<span class="situation font-weight-bold" style="color: #ff2020">Expired</span>');
                    }
                } else {
                    $('#subscription').append('<span class="situation font-weight-bold" style="color:blue">Free</span>');

                }
                console.log(resultado);
                $('.mudar').show();
                destravar_botao_registro();


            } else {
                if (resultado.user_list.length === 0) {
                    $('.body-page').append('<div class="alert alert-danger alert-dismissable col-md-12" style="margin-top: 50px;"><a href="#" class="close" data-dismiss="alert" aria-label="close">×</a></div>');
                    destravar_botao_registro();
                    $(".alert-danger").append(resultado.message);
                    $('.mudar').hide()
                } else if (resultado.user_list.length === 1) {
                    destravar_botao_registro();
                    mudarDados(resultado.user_list[0].username);
                } else {
                    destravar_botao_registro();
                    $('.body-page').append('<div class="list-group col-md-12" style="padding:0;margin-top:30px"></div>');
                    for (var lista = 1; lista <= resultado.user_list.length; lista++) {
                        //dark ou action
                        var clickList = 'mudarDados("' + resultado.user_list[lista - 1].username + '")';
                        $('.list-group').append('<button type="button" class="list-group-item list-group-item-action button1" onclick="" ></button>');
                        $(".button1").addClass("email" + lista);
                        $(".button1").removeClass("button1");
                        var fName = resultado.user_list[lista - 1].firstName;
                        var lName = resultado.user_list[lista - 1].lastName;
                        if (fName) {
                            $(".email" + lista).append(resultado.user_list[lista - 1].username + ' ' + "(" + (fName + ' ' + (lName || '')).trim() + ")");
                        } else {
                            $(".email" + lista).append(resultado.user_list[lista - 1].username);
                        }
                        $(".email" + lista).attr("onclick", clickList);
                    }
                    $('.mudar').hide()
                }

                //Se as informações forem válidas, uma alerta será exibido com a mensagem de Sucesso.
            }

        }).withFailureHandler(function (resultado) {
            // Caso aconteça algum erro no Back_End, irá cair nessa função e retornar um erro especifíco.
            destravar_botao_registro();
            $('.body-page').append('<div class="alert alert-danger alert-dismissable" style="margin-top: 50px;"><a href="#" class="close" data-dismiss="alert" aria-label="close">×</a></div>');
            $(".alert-danger").html('ERROR ' + resultado.message);
            console.log(resultado)


        }).checar_cadastro(user);
        return false;
        console.log('ta indo ok')


    }

    /**
     * Função que recebe um email como parâmetro e cria uma tabela com dados dos usuários encontrados.
     * @param email
     * @returns {boolean} DataTable
     */
    function dataTableUsers(email) {

        $("#connectionsInfo").remove();
        $("#connectionsInfo_wrapper").remove();
        $("#usersInfo").remove();
        $("#usersInfo_wrapper").remove();
        $(".body-page").after('<table id="usersInfo" class="table table-striped table-bordered nowrap" cellspacing="0" width="100%"></table>');
        $(".list-group").remove();
        $('.formulario').hide();
        var tableTarget = email || $('#email-table').val();
        $(".alert").remove();
        $('#botao-table').html('Wait...').attr('disabled', 'disabled');

        google.script.run.withSuccessHandler(function (tabelaDados) {
            //Função recebe um {JSON} e faz uma comparação.

            //Caso o usuário for inválido, inexistente ou exceder o limite de conexões, irá retornar um alerta de erro.
            if (tabelaDados.status === 0) {
                $('.body-page').append('<div class="alert alert-danger alert-dismissable col-md-12" style="margin-top: 50px;"><a href="#" class="close" data-dismiss="alert" aria-label="close">×</a></div>');
                destravar_botao_table();
                $(".alert-danger").append(tabelaDados.message);
                $('.table').hide();
                //Se as informações forem válidas, uma alerta será exibido com a mensagem de Sucesso.
            } else {
                console.log(tabelaDados);
                $('.table').show();
                destravar_botao_table();
                var table = $('#usersInfo').DataTable({
                    "scrollX": true,
                    data: tabelaDados.dataArray,
                    columns: [
                        {title: "Email"},
                        {title: "Plan"},
                        {title: "Status"},
                        {title: "Created At"},
                        {title: "Last Access"},
                        //{title: "Beta?"},
                        {title: "Bonus"},
                        {title: "Imports LM"},
                        {title: "Imports M"},
                        //{title: "Run Out"},
                        {title: "Survey"},
                        {title: "Team?"},
                        {title: "Connections"},
                        {title: "Consolidate"},
                        {title: "Hourly"},
                        {title: "Daily"},
                        {title: "Weekly"},
                        {title: "Monthly"}
                    ]
                });
                $('#usersInfo tbody').on('click', 'tr', function () {
                    var specificUser = table.row(this).data();
                    $('.dt-bootstrap4').hide();
                    mudarDados(specificUser[0]);

                });
            }

        }).withFailureHandler(function (tabelaDados) {
            // Caso aconteça algum erro no Back_End, irá cair nessa função e retornar um erro especifíco.
            destravar_botao_table();
            $('.body-page').append('<div class="alert alert-danger alert-dismissable" style="margin-top: 50px;"><a href="#" class="close" data-dismiss="alert" aria-label="close">×</a></div>');
            $(".alert-danger").html('ERROR ' + tabelaDados.message);
            console.log(tabelaDados)


        }).usersDataTable(tableTarget);
        return false;
        console.log('ta indo ok')


    }

    /**
     * TABELA DE CONEXÕES
     * @returns {boolean}
     */
    function dataTableConnections() {
        $("#usersInfo").remove();
        $("#usersInfo_wrapper").remove();
        $("#connectionsInfo").remove();
        $("#connectionsInfo_wrapper").remove();
        $(".body-page").after('<table id="connectionsInfo" class="table table-striped table-bordered nowrap" cellspacing="0" width="100%"></table>');
        $(".list-group").remove();
        $('.formulario').hide();
        $('#form-registers').hide();
        $(".alert").remove();
        var connectionTarget = $('#registro-user').text();
        var consolidateSet = [];

        google.script.run.withSuccessHandler(function (response) {
            //Função recebe um {JSON} e faz uma comparação.
            console.log(response);
            $('.table').show();
            for (var i = 0; i < response.dataArray.length; i++) {
                response.dataArray[i].unshift('');
                consolidateSet.push([response.dataArray[i].pop()]);

            }
            var table = $('#connectionsInfo').DataTable({
                "scrollX": true,
                data: response.dataArray,
                columns: [
                    {title: " "},
                    {title: "Object ID"},
                    //{title: "Email"},
                    {title: "Flow"},
                    {title: "Connection Name"},
                    {title: "Connection type"},
                    //{title: "Consolidate"},
                    {title: "Trigger"},
                    {title: "Update Recurrency"},
                    {title: "Spreadsheet ID"},
                    {title: "Spreadsheet Name"},
                    {title: "Source ID"},
                    {title: "Source Name"},
                    {title: "Source Sheet"},
                    {title: "Source Type"},
                    {title: "Created At"},
                    {title: "Updated At"},
                    {title: "Database Update"},
                    {title: "Filter"},
                    {title: "Origin"},
                    {title: "TimeZone"},
                    {title: "Error Message"}
                ],
                createdRow: function (row, data, index) {
                    //
                    // if the second column cell is blank apply special formatting
                    //
                    if (data[4].indexOf("Consolidate") > -1) {
                        $(row).find(">:first-child").addClass('details-control');
                    }
                }
            });

            function format(d, rowIndex) {
                // `d` is the original data object for the row
                var html = '<tr>' +
                    '<td>Source IDs:</td>';

                for (var column = 0; column < consolidateSet[rowIndex][0].length; column++) {
                    if (consolidateSet[rowIndex][0].length > 1) {
                        html = html +
                            '<td>' + consolidateSet[rowIndex][0][column][0] + '</td>'
                    }

                }
                html = html + '</tr>' +
                    '<tr>' +
                    '<td>Spreadsheets Name:</td>';
                for (var column = 0; column < consolidateSet[rowIndex][0].length; column++) {
                    if (consolidateSet[rowIndex][0].length > 1) {
                        html = html +
                            '<td>' + consolidateSet[rowIndex][0][column][1] + '</td>'
                    }

                }
                html = html + '</tr>' +
                    '<tr>' +
                    '<td>Source Sheets Name:</td>';
                for (var column = 0; column < consolidateSet[rowIndex][0].length; column++) {
                    if (consolidateSet[rowIndex][0].length > 1) {
                        html = html +
                            '<td>' + consolidateSet[rowIndex][0][column][2] + '</td>'
                    }

                }
                html = html + '</tr>';


                return '<table cellpadding="5" cellspacing="0" border="0" style="padding-left:50px;">' + html + '</table>';

            }


            $('#connectionsInfo tbody').on('click', 'td.details-control', function () {
                var tr = $(this).closest('tr');
                var row = table.row(tr);


                if (row.child.isShown()) {
                    // This row is already open - close it
                    row.child.hide();
                    tr.removeClass('shown');
                }
                else {
                    // Open this row
                    row.child(format(row.data(), row[0])).show();
                    tr.addClass('shown');
                }
            });


        }).withFailureHandler(function (response) {
            // Caso aconteça algum erro no Back_End, irá cair nessa função e retornar um erro especifíco.
            $('.body-page').append('<div class="alert alert-danger alert-dismissable" style="margin-top: 50px;"><a href="#" class="close" data-dismiss="alert" aria-label="close">×</a></div>');
            $(".alert-danger").html('ERROR ' + response.message);
            console.log(response)


        }).connectionList(connectionTarget);
        return false;
        console.log('ta indo ok')


    }

</script>
</body>
</html>

